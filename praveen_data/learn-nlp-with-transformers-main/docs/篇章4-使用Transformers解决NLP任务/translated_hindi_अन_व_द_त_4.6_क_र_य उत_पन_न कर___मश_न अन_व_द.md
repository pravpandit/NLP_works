рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдЬрдкреНрдЯрд░ рдиреЛрдЯрдмреБрдХ [рдЕрдзреНрдпрд╛рдп 4 рдХреЛрдб рдмреЗрд╕](https://github.com/datawhalechina/learn-nlp-with-transformers/tree/main/docs/%E7%AF%87%E7%) рдореЗрдВ рд╣реИ AB%A04-%E4%BD%BF%E7%94%A8Transformers%E8%A7%A3%E5%86%B3NLP%E4%BB%BB%E5%8A%A1).

рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рдбреЗрдЯрд╛рд╕реЗрдЯ рдФрд░ рдореЙрдбрд▓ рдХреЛ рддреБрд░рдВрдд рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХреЛ рд╕реАрдзреЗ Google рдХреЛрд▓рд╛рдм рдиреЛрдЯрдмреБрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЦреЛрд▓рдиреЗ рдХреА рдЕрдиреБрд╢рдВрд╕рд╛ рдХреА рдЬрд╛рддреА рд╣реИред
рдпрджрд┐ рдЖрдк рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЛ Google рдХреЛрд▓реИрдм рдореЗрдВ рдЦреЛрд▓ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдорд░ рдФрд░ ЁЯдЧрдбреЗрдЯрд╛рд╕реЗрдЯ рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬрд╝ рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрди рдЖрджреЗрд╢ред

```рдЕрдЬрдЧрд░
! рдкрд┐рдк рдЗрдВрд╕реНрдЯрд╛рд▓ рдбреЗрдЯрд╛рд╕реЗрдЯ рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдорд░ "рд╕реИрдХреНрд░реЗрдмреНрд▓реВ>=1.4.12,<2.0.0" рд╡рд╛рдХреНрдп рдЯреБрдХрдбрд╝рд╛
```

рдпрджрд┐ рдЖрдк рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреЛ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдЦреЛрд▓ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдХреГрдкрдпрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдиреЗ рдЯреНрд░рд╛рдВрд╕рдлрд╛рд░реНрдорд░-рдХреНрд╡рд┐рдХ-рд╕реНрдЯрд╛рд░реНрдЯ-рдЬрд╝реЗрдб рд░реАрдбрдореА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рднреА рдирд┐рд░реНрднрд░рддрд╛рдУрдВ рдХреЛ рдзреНрдпрд╛рди рд╕реЗ рдкрдврд╝рд╛ рдФрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рд╣реИред рдЖрдк рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХрд╛ рдПрдХ рдорд▓реНрдЯреА-рдЬреАрдкреАрдпреВ рд╡рд┐рддрд░рд┐рдд рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╕рдВрд╕реНрдХрд░рдг рднреА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ [рдпрд╣рд╛рдВ] (https)ред ://github.com/huggingface/transformers/tree/master/examples/seq2seq)ред

# рдЕрдиреБрд╡рд╛рдж рдХреЗ рд▓рд┐рдП рдЯреНрд░рд╛рдВрд╕рдлрд╛рд░реНрдорд░ рдореЙрдбрд▓ рдХреЛ рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рдХрд░рдирд╛рдХрд╛рд░реНрдп

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдореЗрдВ, рд╣рдо рджрд┐рдЦрд╛рдПрдВрдЧреЗ рдХрд┐ рдкреНрд░рд╛рдХреГрддрд┐рдХ рднрд╛рд╖рд╛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдЕрдиреБрд╡рд╛рдж рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [ЁЯдЧ рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдорд░реНрд╕] (https://github.com/huggingface/transformers) рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВред рд╣рдо [WMT рдбреЗрдЯрд╛рд╕реЗрдЯ] (http) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ ://www.statmt.org/wmt16/) рдпрд╣ рдЕрдиреБрд╡рд╛рдж рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред

рдПрдХ рдЙрджрд╛рд╣рд░рдг рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:

![рдЕрдиреБрд╡рд╛рдж рдХрд╛рд░реНрдп рдкрд░ рд╡рд┐рдЬреЗрдЯ рдЕрдиреБрдорд╛рди](https://github.com/huggingface/notebooks/blob/master/examples/images/translation.png?raw=1)рдЕрдиреБрд╡рд╛рдж рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП, рд╣рдо рджрд┐рдЦрд╛рдПрдВрдЧреЗ рдХрд┐ рдПрдХ рд╕рд░рд▓ рдбреЗрдЯрд╛рд╕реЗрдЯ рд▓реЛрдбрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ рдФрд░ рдЖрд░ рдореЗрдВ рдЯреНрд░реЗрдирд░ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореЙрдбрд▓ рдХреЛ рд╕рдВрдмрдВрдзрд┐рдд рдлрд╝рд╛рдЗрди-рдЯреНрдпреВрди рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

```рдЕрдЬрдЧрд░
рдореЙрдбрд▓_рдЪреЗрдХрдкреЙрдЗрдВрдЯ = "рд╣реЗрд▓рд╕рд┐рдВрдХреА-рдПрдирдПрд▓рдкреА/рдУрдкрд╕-рдПрдордЯреА-рдПрди-рдЖрд░рдУ"
# рдПрдХ рдореЙрдбрд▓ рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдЪреБрдиреЗрдВ
```

рдЬрдм рддрдХ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдЯреНрд░рд╛рдВрд╕рдлрд╛рд░реНрдорд░ рдореЙрдбрд▓ рдореЗрдВ seq2seq рд╕рдВрд░рдЪрдирд╛ рдХреА рдПрдХ рдкреНрд░рдореБрдЦ рдкрд░рдд рд╣реЛрддреА рд╣реИ, рдпрд╣ рдиреЛрдЯрдмреБрдХ рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ рдХрд┐рд╕реА рднреА рдЕрдиреБрд╡рд╛рдж рдХрд╛рд░реНрдп рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдЯреНрд░рд╛рдВрд╕рдлрд╛рд░реНрдорд░ рдореЙрдбрд▓ [рдореЙрдбрд▓ рдкреИрдирд▓] (https://huggingface.co/models) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕ рдПрдЖрд░ рдореЗрдВрдЯрд┐рдХрд┐рдХрд▓, рд╣рдо рдЕрдиреБрд╡рд╛рдж рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд [`рд╣реЗрд▓рд╕рд┐рдВрдХреА-рдПрдирдПрд▓рдкреА/рдУрдкрд╕-рдПрдордЯреА-рдПрди-рд░реЛ`](https://huggingface.co/Helsinki-NLP/opus-mt-en-ro) рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред

## рдбреЗрдЯрд╛ рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ

рд╣рдо рдбреЗрдЯрд╛ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рдореВрд▓реНрдпрд╛рдВрдХрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ЁЯдЧ рдбреЗрдЯрд╛рд╕реЗрдЯ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред рдбреЗрдЯрд╛ рд▓реЛрдбрд┐рдВрдЧ рдФрд░ рдореВрд▓реНрдпрд╛рдВрдХрди рд╡рд┐рдзрд┐ рд▓реЛрдбрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рд▓реЛрдб_рдбреЗрдЯрд╛рд╕реЗрдЯ рдФрд░ рд▓реЛрдб_рдореЗрдЯреНрд░рд┐рдХ рдХреЗ рд╕рд░рд▓ рдЙрдкрдпреЛрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рд╣рдо WMT рдбреЗрдЯрд╛рд╕реЗрдЯ рдореЗрдВ рдЕрдВрдЧреНрд░реЗрдЬреА/рд░реЛрдорд╛рдирд┐рдпрд╛рдИ рджреНрд╡рд┐рднрд╛рд╖реА рдЕрдиреБрд╡рд╛рдж рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред

```рдЕрдЬрдЧрд░
рдбреЗрдЯрд╛рд╕реЗрдЯ рд╕реЗ рд▓реЛрдб_рдбреЗрдЯрд╛рд╕реЗрдЯ, рд▓реЛрдб_рдореЗрдЯреНрд░рд┐рдХ рдЖрдпрд╛рдд рдХрд░реЗрдВ

raw_рдбреЗрдЯрд╛рд╕реЗрдЯ = рд▓реЛрдб_рдбреЗрдЯрд╛рд╕реЗрдЯ ("wmt16", "ro-en")
рдореАрдЯреНрд░рд┐рдХ = рд▓реЛрдб_рдореЗрдЯреНрд░рд┐рдХ("рд╕реИрдХреНрд░реЗрдмреНрд▓реВ")
```

рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 2.81kB [00:00, 523kB/s]
рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 3.19kB [00:00, 758kB/s]
рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 41.0kB [00:00, 11.0MB/s]

рдбреЗрдЯрд╛рд╕реЗрдЯ wmt16/ro-en рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдФрд░ рддреИрдпрд╛рд░ рдХрд░рдирд╛ (рдбрд╛рдЙрдирд▓реЛрдб: рдЕрдЬреНрдЮрд╛рдд рдЖрдХрд╛рд░, рдЙрддреНрдкрдиреНрди: рдЕрдЬреНрдЮрд╛рдд рдЖрдХрд╛рд░, рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕реНрдб: рдЕрдЬреНрдЮрд╛рдд рдЖрдХрд╛рд░, рдХреБрд▓: рдЕрдЬреНрдЮрд╛рдд рдЖрдХрд╛рд░) рдХреЛ /Users/niepig/.cache/huggingface/datasets/wmt16/ro-en рдкрд░ред /1.0.0/0d9fb3e814712c785176ad8cdb9f465fbe6479000ee6546725db30ad8a8b5f8a...

рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ|225рдПрдо/225рдПрдо[00:18<00:00, 12.2рдПрдордмреА/рд╕реЗрдХреЗрдВрдб]
рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ|23.5M/23.5M [00:16<00:00, 1.44MB/s]
рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ|38.7рдПрдо/38.7рдПрдо [00:03<00:00, 9.82рдПрдордмреА/рд╕реЗрдХрдВрдб]

рдбреЗрдЯрд╛рд╕реЗрдЯ wmt16 рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рдФрд░ /Users/niepig/.cache/huggingface/datasets/wmt16/ro-en/1.0.0/0d9fb3e814712c785176ad8cdb9f465fbe6479000ee6546725db30ad8a8b5f8a рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ред рдмрд╛рдж рдХреА рдХреЙрд▓реЗрдВ рдЗрд╕ рдбреЗрдЯрд╛ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреА рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ: 5.40kB [00:00, 2.08MB/s ]

рдпрд╣ рдбреЗрдЯрд╛рд╕реЗрдЯ рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реНрд╡рдпрдВ рдПрдХ [`DatasetDict`](https://huggingface.co/docs/datasets/package_refe) рд╣реИrence/main_classes.html#datasetdict) рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ред рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╕реЗрдЯ, рд╕рддреНрдпрд╛рдкрди рд╕реЗрдЯ рдФрд░ рдкрд░реАрдХреНрд╖рдг рд╕реЗрдЯ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рд╕рдВрдмрдВрдзрд┐рдд рдХреБрдВрдЬреА (рдЯреНрд░реЗрди, рд╕рддреНрдпрд╛рдкрди, рдкрд░реАрдХреНрд╖рдг) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

```рдЕрдЬрдЧрд░
raw_datasets
```

рдбреЗрдЯрд╛рд╕реЗрдЯрдбрд┐рдХреНрдЯ({
рдЯреНрд░реЗрди: рдбреЗрдЯрд╛рд╕реЗрдЯ({
рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ: ['рдЕрдиреБрд╡рд╛рдж'],
num_rows: 610320
})
рд╕рддреНрдпрд╛рдкрди: рдбреЗрдЯрд╛рд╕реЗрдЯ({
рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ: ['рдЕрдиреБрд╡рд╛рдж'],
num_rows: 1999})
рдкрд░реАрдХреНрд╖рдг: рдбреЗрдЯрд╛рд╕реЗрдЯ({
рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ: ['рдЕрдиреБрд╡рд╛рдж'],
num_rows: 1999
})
})

рдбреЗрдЯрд╛ рд╡рд┐рднрд╛рдЬрди рдХреБрдВрдЬреА (рдЯреНрд░реЗрди, рд╕рддреНрдпрд╛рдкрди рдпрд╛ рдкрд░реАрдХреНрд╖рдг) рджреА рдЧрдИрдФрд░ рдПрдХ рд╕рдмрд╕реНрдХреНрд░рд┐рдкреНрдЯ, рдЖрдк рдбреЗрдЯрд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

```рдЕрдЬрдЧрд░
raw_рдбреЗрдЯрд╛рд╕реЗрдЯ["рдЯреНрд░реЗрди"][0]
# рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдЕрдВрдЧреНрд░реЗрдЬреА рд╡рд╛рдХреНрдп рдПрди рдПрдХ рд░реЛрдорд╛рдирд┐рдпрд╛рдИ рд╡рд╛рдХреНрдп рдЖрд░рдУ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ
```

{'рдЕрдиреБрд╡рд╛рдж': {'рдПрди': 'рд╕рдВрд╕рдж рдХреА рд╕рджрд╕реНрдпрддрд╛: рдорд┐рдирдЯ рджреЗрдЦреЗрдВ',
'ro': 'Componen┼гa Parlamentului: a se vedea procesul-verbal'}}

рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдбреЗрдЯрд╛ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ, рдирд┐рдореНрди рдлрд╝рдВрдХреНрд╢рди рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛рд╕реЗрдЯ рд╕реЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдХреБрдЫ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХрд╛ рдЪрдпрди рдХрд░реЗрдЧрд╛ред

```рдЕрдЬрдЧрд░
рдбреЗрдЯрд╛рд╕реЗрдЯ рдЖрдпрд╛рдд рдХрд░реЗрдВ
рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЖрдпрд╛рдд рдХрд░реЗрдВ
рдкрд╛рдВрдбрд╛ рдХреЛ рдкреАрдбреА рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдпрд╛рдд рдХрд░реЗрдВ
fromIPythрдСрди.рдбрд┐рд╕реНрдкреНрд▓реЗ рдЖрдпрд╛рдд рдбрд┐рд╕реНрдкреНрд▓реЗ, HTML

def show_random_elements(рдбреЗрдЯрд╛рд╕реЗрдЯ, num_examples=5):
assert num_examples <= len(рдбреЗрдЯрд╛рд╕реЗрдЯ), "рдбреЗрдЯрд╛рд╕реЗрдЯ рдореЗрдВ рдореМрдЬреВрдж рддрддреНрд╡реЛрдВ рд╕реЗ рдЕрдзрд┐рдХ рддрддреНрд╡ рдирд╣реАрдВ рдЪреБрди рд╕рдХрддреЗред"
рдЪреБрдирддрд╛ рд╣реИ = []
рд░реЗрдВрдЬ рдореЗрдВ _ рдХреЗ рд▓рд┐рдП (num_examples):
рдкрд┐рдХ = рд░реИрдВрдбрдо.рд░реИрдВрдбрд┐рдВрдЯ(0, рд▓реЗрди(рдбреЗрдЯрд╛рд╕реЗрдЯ)-1)
рдЪрдпрди рдХрд░рддреЗ рд╕рдордп:
рдкрд┐рдХ = рд░реИрдВрдбрдо.рд░реИрдВрдбрд┐рдВрдЯ(0, рд▓реЗрди(рдбреЗрдЯрд╛рд╕реЗрдЯ)-1)
рдЪреБрдирддрд╛ рд╣реИ.рдЬреЛрдбрд╝реЗрдВ(рдЪреБрдиреЗрдВ)

рдбреАрдПрдл = рдкреАрдбреА.рдбреЗрдЯрд╛рдлрд╝реНрд░реЗрдо(рдбреЗрдЯрд╛рд╕реЗрдЯ[рдЪреБрдирддрд╛ рд╣реИ])
рдХреЙрд▓рдо рдХреЗ рд▓рд┐рдП, dataset.features.items() рдЯрд╛рдЗрдк рдХрд░реЗрдВ:
рдпрджрд┐ isinstance(type,datasets.ClassLabel):
рдбреАрдПрдл[рдХреЙрд▓рдо] = рдбреАрдПрдл[рдХреЙрд▓рдо].рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдо(рд▓реИрдореНрдмрджрд╛ i: рдЯрд╛рдЗрдк.рдирд╛рдо[i])
рдбрд┐рд╕реНрдкреНрд▓реЗ(HTML(df.to_html()))
```

```рдЕрдЬрдЧрд░
show_random_elements(raw_datasets["рдЯреНрд░реЗрди"])
```

<рддрд╛рд▓рд┐рдХрд╛ рд╕реАрдорд╛ = "1" рд╡рд░реНрдЧ = "рдбреЗрдЯрд╛рдлрд╝реНрд░реЗрдо">
<рд╕рд┐рд░>
<tr рд╢реИрд▓реА = "рдкрд╛рда-рд╕рдВрд░реЗрдЦрдг: рджрд╛рдПрдВ;">
<рде></рде>
<th>рдЕрдиреБрд╡рд╛рдж</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>{'en': 'рдореБрдЭреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдпрд╣ рд╕рд╣реА рд░рд╛рд╕реНрддрд╛ рд╣реИред', 'ro': 'рдореБрдЭреЗ рдЗрд╕ рдмрд╛рдд рдХрд╛ рдкреВрд░рд╛ рднрд░реЛрд╕рд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рд╣реИред'}</td></tr>
<tr>
<th>1</th>
<td>{'en': 'рдпреВрд░реЛрдкреАрдп рд░рд╕рд╛рдпрди рдПрдЬреЗрдВрд╕реА рдореЗрдВ рдХреБрд▓ 104 рдирдИ рдиреМрдХрд░рд┐рдпрд╛рдБ рд╕реГрдЬрд┐рдд рд╣реБрдИрдВ, рдЬреЛ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдкрд░реНрдпрд╡реЗрдХреНрд╖рдг рдХрд░рддреА рд╣реИрдВрд╣рдорд╛рд░реЗ REACH рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рджреЗрдЦреЗрдВред рдЙрддреНрдкрд╛рдж рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдПрдЬреЗрдВрд╕рд┐рдпреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ, рджреЗрдЦрднрд╛рд▓ рдХрд░реЗрдВ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡реЛрддреНрддрдо рд╕реЗрд╡рд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░реЗрдВред'}</td>
</tr>
<tr>
<th>2</th>
<td>{'en': 'рдЙрдкрд░реЛрдХреНрдд рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рдХреНрдпрд╛ рдкрд░рд┐рд╖рдж рдпрд╣ рдХрд╣реЗрдЧреА рдХрд┐ рд╕рдВрдпреБрдХреНрдд рдлреНрд░реЛрдВрдЯреЗрдХреНрд╕ рдСрдкрд░реЗрд╢рди рдореЗрдВ рддреБрд░реНрдХреА рдХреА рднрд╛рдЧреАрджрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЪрд░реНрдЪрд╛ рдХрд┐рд╕ рд╕реНрддрд░ рдкрд░ рдкрд╣реБрдВрдЪ рдЧрдИ рд╣реИ?', 'ro': 'рдХреНрдпрд╛ рдЯреВрд░ рд╣реЛрдЧрд╛рдХрд┐рд╢ рд╕рд░рдХрд╛рд░ рдлреНрд░реЛрдВрдЯреЗрдХреНрд╕ рдореЗрдВ рддреБрд░реНрдХреА рдУрдкреЗрд░рд╛ рдХреА рдирдЧрд░ рдкрд╛рд▓рд┐рдХрд╛ рдХреЗ рд╕рджрд╕реНрдпреЛрдВ рдХреЛ рд░реЗрдлрд░рд▓ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧреА?'}</td>
</tr>
<tr>
<рде>3</рде>
<td>{'en': 'рдЕрдм рд╣рдореЗрдВ рдбрд░ рд╣реИ рдХрд┐ рдпрджрд┐ рдЗрд╕ рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рджрд╛рдпрд░рд╛ рдмрдврд╝рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рд╡рд╣реА рд╣рд╢реНрд░ рд╣реЛрдЧрд╛ рдЬреЛ 'рдореЗрдб рдЗрди' рдореВрд▓ рдЕрдВрдХрди рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рдкрд┐рдЫрд▓реЗ рдкреНрд░рдпрд╛рд╕ рдХрд╛ рд╣реБрдЖ рдерд╛ - рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдХрд┐ рдпрд╣ рд╣реЛрдЧрд╛ рдПрдХ рдмрд╛рд░ рдлрд┐рд░ рдкрд░рд┐рд╖рдж рджреНрд╡рд╛рд░рд╛ рдЕрд╡рд░реБрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред', 'рдЖрд░рдУ': 'рд╣рдореЗрдВ рдпрдХреАрди рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдПрдХ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рд▓рд┐рдП рдЖрд╡реЗрджрди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдкрд╣рд▓реЗ рд╣реА рдареАрдХ рд╡реИрд╕рд╛ рд╣реА рдкрд░рд┐рдгрд╛рдо рджреЗрдЦ рдЪреБрдХреЗ рд╣реИрдВts, рд╣рдордиреЗ рдПрдХ рдорд╛рд░реНрдХрд╛рдЬреБрд▓реБрдИ рдореВрд▓ "рдореЗрдб рдЗрди" рднреА рдкреЗрд╢ рдХрд┐рдпрд╛ рд╣реИ, рдЬреЛ рдПрдХ рдЕрдЪреНрдЫрд╛ рдЙрджрд╛рд╣рд░рдг рднреА рд╣реИ, рд╣рдо рджреЗрд╢ рдХрд╛ рдирдХреНрд╢рд╛ рднреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред'}</td>
</tr>
<tr>
<рде>4</рде>
<td>{'en': 'рджреЗрд╢ 6.58 рдХреЗ рд╕реНрдХреЛрд░ рдХреЗ рд╕рд╛рде рдиреМ рдкрд╛рдпрджрд╛рди рдЧрд┐рд░рдХрд░ 85рд╡реЗрдВ рд╕реНрдерд╛рди рдкрд░ рдЖ рдЧрдпрд╛ред', 'ro': '6.58 рдХреЗ рд╕реНрдХреЛрд░ рдХреЗ рд╕рд╛рде рджреЗрд╢ рдХрд╛ рд╕реНрдХреЛрд░ 85 рдХрдо рд╣реИред'}</td >
</tr>
</tbody>
</рддрд╛рд▓рд┐рдХрд╛>

рдореАрдЯреНрд░рд┐рдХ [`datasets.Metric`](https://huggingface.co/docs/datasets/package_reference/main_classes.html#datasets.Metric) рд╡рд░реНрдЧ рд╣реИ, рдореАрдЯреНрд░рд┐рдХ рдФрд░ рдЙрдкрдпреЛрдЧ рдХреЗ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ:

```рдЕрдЬрдЧрд░
рдореАрдЯреНрд░рд┐рдХ
```

рдореАрдЯреНрд░рд┐рдХ(рдирд╛рдо: "рд╕реИрдХреНрд░реЗрдмреНрд▓реВ", рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ: {'рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпрд╛рдБ': рдорд╛рди(dtype='string', id='рдЕрдиреБрдХреНрд░рдо'), 'рд╕рдВрджрд░реНрдн': рдЕрдиреБрдХреНрд░рдо(рд╕реБрд╡рд┐рдзрд╛=рдорд╛рди(dtype='string', id='рдЕрдиреБрдХреНрд░рдо '), рд▓рдВрдмрд╛рдИ=-1, рдЖрдИрдбреА='рд╕рдВрджрд░реНрдн')}, рдЙрдкрдпреЛрдЧ: """
рдЕрдкрдиреЗ рдкрд░реНрдпрд╛рдкреНрдд рдЖрдБрдХрдбрд╝реЛрдВ рдХреЗ рд╕рд╛рде BLEU рд╕реНрдХреЛрд░ рддреИрдпрд╛рд░ рдХрд░рддрд╛ рд╣реИ
рдПрдХ рд╕реНрд░реЛрдд рд╕реЗ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рд╕рдВрджрд░реНрднреЛрдВ рдХреЗ рд╡рд┐рд░реБрджреНрдзред

рддрд░реНрдХ:
рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпрд╛рдБ: рд╕рд┐рд╕реНрдЯрдо рд╕реНрдЯреНрд░реАрдо (рдЦрдВрдбреЛрдВ рдХрд╛ рдПрдХ рдХреНрд░рдо)
рд╕рдВрджрд░реНрдн: рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рд╕рдВрджрд░реНрдн рдзрд╛рд░рд╛рдУрдВ рдХреА рд╕реВрдЪреА (рдкреНрд░рддреНрдпреЗрдХ рдЦрдВрдбреЛрдВ рдХрд╛ рдПрдХ рдХреНрд░рдо)
рдЪрд┐рдХрдирд╛: рдЪрд┐рдХрдирд╛ рдХрд░рдиреЗ рдХреА рд╡рд┐рдзрд┐рдЙрдкрдпреЛрдЧ
рд╕реНрдореВрде_рд╡реИрд▓реНрдпреВ: 'рдлрд░реНрд╢' рд╕реНрдореВрдердирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП, рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдлрд░реНрд╢
рдмрд▓: рдЙрд╕ рдбреЗрдЯрд╛ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░реЗрдВ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЯреЛрдХрдирдпреБрдХреНрдд рджрд┐рдЦрддрд╛ рд╣реИ
рд▓реЛрдЕрд░рдХреЗрд╕: рдбреЗрдЯрд╛ рдХреЛ рд▓реЛрдЕрд░рдХреЗрд╕ рдХрд░реЗрдВ
рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝: рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░
рд░рд┐рдЯрд░реНрди:
'рд╕реНрдХреЛрд░': BLEU рд╕реНрдХреЛрд░,
'рдЧрд┐рдирддреА': рдЧрд┐рдирддреА,
'рдХреБрд▓': рдХреБрд▓,
'рдкрд░рд┐рд╢реБрджреНрдзрддрд╛': рдкрд░рд┐рд╢реБрджреНрдзрддрд╛,
'рдмреАрдкреА': рд╕рдВрдХреНрд╖рд┐рдкреНрддрддрд╛ рджрдВрдб,
'sys_len': рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдХреА рд▓рдВрдмрд╛рдИ,
'ref_len': рд╕рдВрджрд░реНрдн рд▓рдВрдмрд╛рдИ,
рдЙрджрд╛рд╣рд░рдг:

>>> рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпрд╛рдВ = ["рд╣реИрд▓реЛ рдЬрдирд░рд▓ рдХреЗрдиреЛрдмреА", "рдлреВ рдмрд╛рд░ рдлреВрдмрд╛рд░"]
>>> рд╕рдВрджрд░реНрдн = [["рд╣реИрд▓реЛ рдЬрдирд░рд▓ рдХреЗрдиреЛрдмреА", "рд╣реИрд▓реЛ!"], ["рдлреВ рдмрд╛рд░ рдлреВрдмрд╛рд░", "рдлреВ рдмрд╛рд░ рдлреВрдмрд╛рд░"]]
>>> sacrebleu = datasets.load_metric("sacrebleu")
>>> рдкрд░рд┐рдгрд╛рдо = sacrebleu.compute(рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпрд╛рдВ=рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпрд╛рдВ, рд╕рдВрджрд░реНрдн=рд╕рдВрджрд░реНрдн)
>>> рдкреНрд░рд┐рдВрдЯ(рд╕реВрдЪреА(рдкрд░рд┐рдгрд╛рдо.рдХреБрдВрдЬрд┐рдпрд╛рдБ()))
['рд╕реНрдХреЛрд░', 'рдЧрд┐рдирддреА', 'рдХреБрд▓', 'рдкрд░рд┐рд╢реБрджреНрдзрддрд╛', 'рдмреАрдкреА', 'sys_len', 'ref_len']
>>> рдкреНрд░рд┐рдВрдЯ(рд░рд╛рдЙрдВрдб(рдкрд░рд┐рдгрд╛рдо["рд╕реНрдХреЛрд░"], 1))
100.0
""", рд╕рдВрдЧреНрд░рд╣реАрдд рдЙрджрд╛рд╣рд░рдг: 0)

рд╣рдо рд╕реНрдХреЛрд░ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдиреЛрдВ рдФрд░ рд▓реЗрдмрд▓реЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `рдЧрдгрдирд╛` рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдиреЛрдВ рдФрд░ рд▓реЗрдмрд▓реЛрдВ рджреЛрдиреЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПрдкреНрд░рд╛рд░реВрдк:

```рдЕрдЬрдЧрд░
рдлреЗрдХ_рдкреНрд░реЗрдбреНрд╕ = ["рд╣реИрд▓реЛ рджреЗрдпрд░", "рдЬрдирд░рд▓ рдХреЗрдиреЛрдмреА"]
рдлреЗрдХ_рд▓реЗрдмрд▓реНрд╕ = [["рд╣реИрд▓реЛ рджреЗрдпрд░"], ["рдЬрдирд░рд▓ рдХреЗрдиреЛрдмреА"]]
metric.compute(рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпрд╛рдВ=рдирдХрд▓реА_рдкреНрд░реЗрдб, рд╕рдВрджрд░реНрдн=рдирдХрд▓реА_рд▓реЗрдмрд▓)
```

{'рд╕реНрдХреЛрд░': 0.0,
'рдЧрд┐рдирддреА': [4, 2, 0, 0],
'рдХреБрд▓': [4, 2, 0, 0],
'рдкрд░рд┐рд╢реБрджреНрдзрддрд╛': [100.0, 100.0, 0.0, 0.0],
'рдмреАрдкреА': 1.0,
'sys_len': 4,
'рд░реЗрдл_рд▓реЗрди': 4}

## рдбреЗрдЯрд╛ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ

рдореЙрдбрд▓ рдореЗрдВ рдбреЗрдЯрд╛ рдлреАрдб рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдЯреВрд▓ рдХреЛ рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИрдкреБрдЯ, рдлрд┐рд░ рдЯреЛрдХрди рдХреЛ рдкреНрд░реА-рдореЙрдбрд▓ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рд╕рдВрдмрдВрдзрд┐рдд рдЯреЛрдХрди рдЖрдИрдбреА рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдореЙрдбрд▓ рджреНрд╡рд╛рд░рд╛ рдЖрд╡рд╢реНрдпрдХ рдЗрдирдкреБрдЯ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИред

рдбреЗрдЯрд╛ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЕрдкрдиреЗ рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рдХреЛ рдЗрдВрд╕реНрдЯреЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП AutoTokenizer.from_pretrained рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ:

- рд╣рдореЗрдВ рдПрдХ рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рдорд┐рд▓рддрд╛ рд╣реИ рдЬреЛ рдПрдХ-рдПрдХ рдХрд░рдХреЗ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред
- рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдореЙрдбрд▓ рдЪреЗрдХрдкреЙрдЗрдВрдЯ рдХреЗ рдЕрдиреБрд░реВрдк рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рд╣рдо рдЖрд╡рд╢реНрдпрдХ рд╢рдмреНрджрд╛рд╡рд▓реА рднреА рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВy рдореЙрдбрд▓, рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ, рдЯреЛрдХрди рд╢рдмреНрджрд╛рд╡рд▓реАред

рдЗрд╕ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЧрдИ рдЯреЛрдХрди рд╢рдмреНрджрд╛рд╡рд▓реА рдХреЛ рдХреИрд╢ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рддрд╛рдХрд┐ рджреЛрдмрд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдЗрд╕реЗ рджреЛрдмрд╛рд░рд╛ рдбрд╛рдЙрдирд▓реЛрдб рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

```рдЕрдЬрдЧрд░
рдЯреНрд░рд╛рдВрд╕рдлрд╛рд░реНрдорд░ рд╕реЗ рдСрдЯреЛрдЯреЛрдХрдирд╛рдЗрдЬрд╝рд░ рдЖрдпрд╛рдд рдХрд░реЗрдВ
# `рд╕реЗрдВрдЯреЗрдВрд╕рдкреАрд╕` рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛: рдкрд┐рдк рдЗрдВрд╕реНрдЯреЙрд▓ рд╕реЗрдВрдЯреЗрдВрд╕рдкреАрд╕

рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ = AutoTokenizer.from_pretrained(model_checkpoint)
```

рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ| 1.13k/1.13k [00:00<00:00, 466kB/s]
рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ|789k/789k [00:00<00:00, 882kB/s]
рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ|817k/817k [00:00<00:00, 902kB/s]
рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ| 1.39M/1.39M [00:01<00:00, 1.24MB/s]
рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ|42.0/42.0 [00:00<00:00, 14.6kB/s]

рдЙрджрд╛рд╣рд░рдг рдХреЗ рддреМрд░ рдкрд░ рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ mBART рдореЙрдбрд▓ рдХреЛ рд▓реЗрдВ, рд╣рдореЗрдВ рд╕реНрд░реЛрдд рднрд╛рд╖рд╛ рдФрд░ рд▓рдХреНрд╖реНрдп рднрд╛рд╖рд╛ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЕрдиреНрдп рджреНрд╡рд┐рднрд╛рд╖реА рдХреЙрд░реНрдкреЛрд░рд╛ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдХреГрдкрдпрд╛ [рдпрд╣рд╛рдВ] (https://huggingface.co/facebook/mbart-large) рджреЗрдЦреЗрдВред -cc25) рд╣рдо рд╕реНрд░реЛрдд рдФрд░ рд▓рдХреНрд╖реНрдп рднрд╛рд╖рд╛рдУрдВ рдХреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```рдЕрдЬрдЧрд░
рдпрджрд┐ model_checkpoint рдореЗрдВ "mbart":
рдЯреЛрдХрдирдирд╛рдЗрдЬрд░.рдПрд╕rc_lang = "en-XX"
рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░.tgt_lang = "ro-RO"
```

рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рдПрдХрд▓ рдЯреЗрдХреНрд╕реНрдЯ рдпрд╛ рдЯреЗрдХреНрд╕реНрдЯ рдХреА рдПрдХ рдЬреЛрдбрд╝реА рдХреЛ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЗ рдмрд╛рдж рдкреНрд░рд╛рдкреНрдд рдбреЗрдЯрд╛ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдХреЗ рдЗрдирдкреБрдЯ рдкреНрд░рд╛рд░реВрдк рд╕реЗ рдорд┐рд▓рддрд╛ рд╣реИ

```рдЕрдЬрдЧрд░
рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ ("рд╣реИрд▓реЛ, рдпрд╣ рдПрдХ рд╡рд╛рдХреНрдп!")
```

{'рдЗрдирдкреБрдЯ_рдЖрдИрдбреА': [125, 778, 3, 63, 141, 9191, 23, 0], 'рдЕрдЯреЗрдВрд╢рди_рдорд╛рд╕реНрдХ': [1, 1, 1, 1, 1, 1, 1, 1]}

рдКрдкрд░ рджреЗрдЦреА рдЧрдИ рдЯреЛрдХрди рдЖрдИрдбреА, рдпрд╛рдиреА рдЗрдирдкреБрдЯ_рдЖрдИрдбреНрд╕, рдЖрдо рддреМрд░ рдкрд░ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдХреЗ рдирд╛рдо рдХреЗ рд╕рд╛рде рднрд┐рдиреНрди рд╣реЛрддреА рд╣реИрдВред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрдпрджрд┐ рдЖрдк рдкреНрд░реА-рдЯреНрд░реЗрдирд┐рдВрдЧ рдХреЗ рджреМрд░рд╛рди рдЕрд▓рдЧ-рдЕрд▓рдЧ рдирд┐рдпрдо рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХрд╛ рдЗрдирдкреБрдЯ рдкреНрд░рд╛рд░реВрдк рдореЙрдбрд▓ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░реЗрдЧрд╛ред рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдХреГрдкрдпрд╛ [рдпрд╣ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓](https://huggingface.co/transformers/preprocessing) рджреЗрдЦреЗрдВред .html)

рдХрд┐рд╕реА рд╡рд╛рдХреНрдп рдХреЛ рдЯреЛрдХрдирд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рд╡рд╛рдХреНрдпреЛрдВ рдХреА рд╕реВрдЪреА рдХреЛ рднреА рдЯреЛрдХрдирд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

```рдЕрдЬрдЧрд░
рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░(["рд╣реИрд▓реЛ, рдпрд╣ рдПрдХ рд╡рд╛рдХреНрдп!", "рдпрд╣ рдПрдХ рдФрд░ рд╡рд╛рдХреНрдп рд╣реИред"])
```

{'рдЗрдирдкреБрдЯ_рдЖрдИрдбреА': [[125, 778, 3, 63, 141, 9191, 23, 0], [187, 32, 716, 9191, 2, 0]], 'рдЕрдЯреЗрдВрд╢рди_рдорд╛рд╕реНрдХ': [[1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1]]}

рдиреЛрдЯ: рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд╡рд╛рдж рд▓рдХреНрд╖реНрдп рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд▓рдХреНрд╖реНрдп рдХреЗ рдЕрдиреБрд░реВрдк рд╡рд┐рд╢реЗрд╖ рдЯреЛрдХрди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `as_target_tokenizer` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ:

```рдЕрдЬрдЧрд░
рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░.as_target_tokenizer() рдХреЗ рд╕рд╛рде:
рдкреНрд░рд┐рдВрдЯ (рдЯреЛрдХрдирд╛рдЗрдЬрд╝рд░ ("рд╣реИрд▓реЛ, рдпрд╣ рдПрдХ рд╡рд╛рдХреНрдп!"))
рдореЙрдбрд▓_рдЗрдирдкреБрдЯ = рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ ("рд╣реИрд▓реЛ, рдпрд╣ рдПрдХ рд╡рд╛рдХреНрдп!")
рдЯреЛрдХрди = рдЯреЛрдХрдирд╛рдЗрдЬрд╝рд░.рдХрдиреНрд╡рд░реНрдЯ_рдЖрдИрдбреНрд╕_рдЯреВ_рдЯреЛрдХрдиреНрд╕(рдореЙрдбрд▓_рдЗрдирдкреБрдЯ['рдЗрдирдкреБрдЯ_рдЖрдИрдбреНрд╕'])
# рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ рдФрд░ рд╡рд┐рд╢реЗрд╖ рдЯреЛрдХрди рджреЗрдЦреЗрдВ
рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ ('рдЯреЛрдХрди: {}'.рдкреНрд░рд╛рд░реВрдк(рдЯреЛрдХрди))
```

{'рдЗрдирдкреБрдЯ_рдЖрдИрдбреА': [10334, 1204, 3, 15, 8915, 27, 452, 59, 29579, 581, 23, 0], 'рдЕрдЯреЗрдВрд╢рди_рдорд╛рд╕реНрдХ': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}
рдЯреЛрдХрди: ['рд╣реЗрд▓', 'рд▓реЛ', ',', '', 'рджрд┐рд╕', 'рдУ', 'рдиреЗ', 'рд╕реЗ', 'рдПрдирдЯреЗрди', 'рд╕реАрдИ', '!', '</s >']

рдпрджрд┐ рдЖрдк T5 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдХреЗ рдЪреЗрдХрдкреЙрдЗрдВрдЯреНрд╕ рдХреЛ рд╡рд┐рд╢реЗрд╖ рдЙрдкрд╕рд░реНрдЧреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред T5 рдореЙрдбрд▓ рдХреЛ рдпрд╣ рдмрддрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдЙрдкрд╕рд░реНрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИред рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрд╕рд░реНрдЧ рдЙрджрд╛рд╣рд░рдг рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИрдВ:

```рдЕрдЬрдЧрд░
рдпрджрд┐ рдореЙрдбрд▓_рдЪреЗрдХрдкреЙрдЗрдВрдЯ ["t5-рдЫреЛрдЯрд╛", "t5-рдмреЗрд╕", "t5-рдмрдбрд╝рд╛" рдореЗрдВ рд╣реИ, "t5-3b", "t5-11b"]:
рдЙрдкрд╕рд░реНрдЧ = "рдЕрдВрдЧреНрд░реЗрдЬреА рд╕реЗ рд░реЛрдорд╛рдирд┐рдпрд╛рдИ рдореЗрдВ рдЕрдиреБрд╡рд╛рдж рдХрд░реЗрдВ:"
рдЕрдиреНрдп:
рдЙрдкрд╕рд░реНрдЧ = ""
```

рдЕрдм рд╣рдо рдЕрдкрдиреЗ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ рдПрдХ рд╕рд╛рде рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм рд╣рдо рдирдореВрдиреЛрдВ рдХреЛ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `truncation=True` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рд╣рдорд╛рд░реЗ рд▓рдВрдмреЗ рд╡рд╛рдХреНрдпреЛрдВ рдХреЛ рдЫреЛрдЯрд╛ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╣рдо рдЫреЛрдЯреЗ рд╡рд╛рдХреНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреИрдб рд▓рдЧрд╛рддреЗ рд╣реИрдВред

```рдЕрдЬрдЧрд░
рдЕрдзрд┐рдХрддрдо_рдЗрдирдкреБрдЯ_рд▓рдВрдмрд╛рдИ = 128
рдЕрдзрд┐рдХрддрдо_рд▓рдХреНрд╖реНрдп_рд▓рдВрдмрд╛рдИ = 128
source_lang = "рдПрди"
рд▓рдХреНрд╖реНрдп_рд▓реИрдВрдЧ = "рдЖрд░рдУ"

рдбреАрдИрдПрдлрд╝ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕_рдлрдВрдХреНрд╢рди(рдЙрджрд╛рд╣рд░рдг):
рдЗрдирдкреБрдЯреНрд╕ = [рдЙрдкрд╕рд░реНрдЧ + рдкреВрд░реНрд╡[sрд╕реНрд░реЛрдд]]e_lang] рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдкреВрд░реНрд╡ рдХреЗ рд▓рд┐рдП["рдЕрдиреБрд╡рд╛рдж"]]
рд▓рдХреНрд╖реНрдп = [рдЙрджрд╛[target_lang] рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдкреВрд░реНрд╡ рдХреЗ рд▓рд┐рдП["рдЕрдиреБрд╡рд╛рдж"]]
model_inputs = рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ (рдЗрдирдкреБрдЯ, max_length=max_input_length, рдЯреНрд░рдВрдХреЗрд╢рди=True)

# рд▓рдХреНрд╖реНрдп рдХреЗ рд▓рд┐рдП рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рд╕реЗрдЯрдЕрдк рдХрд░реЗрдВ
рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░.as_target_tokenizer() рдХреЗ рд╕рд╛рде:
рд▓реЗрдмрд▓ = рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ (рд▓рдХреНрд╖реНрдп, рдЕрдзрд┐рдХрддрдо рд▓рдВрдмрд╛рдИ = рдЕрдзрд┐рдХрддрдо рд▓рдХреНрд╖реНрдп_ рд▓рдВрдмрд╛рдИ, рдХрд╛рдЯ-рдЫрд╛рдБрдЯ = рд╕рддреНрдп)

model_inputs["рд▓реЗрдмрд▓"] = рд▓реЗрдмрд▓["input_ids"]
рдореЙрдбрд▓_рдЗрдирдкреБрдЯ рд▓реМрдЯрд╛рдПрдВ
```

рдЙрдкрд░реЛрдХреНрдд рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдирдореВрдирд╛ рдпрд╛ рдПрдХрд╛рдзрд┐рдХ рдирдореВрдирд╛ рдЙрджрд╛рд╣рд░рдг рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИрдПрдХрд╛рдзрд┐рдХ рдирдореВрдиреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдПрдХрд╛рдзрд┐рдХ рдирдореВрдиреЛрдВ рдХреЗ рдкреВрд░реНрд╡-рд╕рдВрд╕рд╛рдзрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдкрд░рд┐рдгрд╛рдо рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рддрд╛ рд╣реИред

```рдЕрдЬрдЧрд░
рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕_рдлрдВрдХреНрд╢рди(рдХрдЪреНрдЪрд╛_рдбреЗрдЯрд╛рд╕реЗрдЯ['рдЯреНрд░реЗрди'][:2])
```

{'рдЗрдирдкреБрдЯ_рдЖрдИрдбреА': [[393, 4462, 14, 1137, 53, 216, 28636, 0], [24385, 14, 28636, 14, 4646, 4622, 53, 216, 28636, 0]], 'рдзреНрдпрд╛рди_рдорд╛рд╕реНрдХ' : [[1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]], 'рд▓реЗрдмрд▓': [ [42140, 494, 1750, 53, 8, 59, 903, 3543, 9, 15202, 0], [36199, 6612, 9, 15202, 122, 568, 35788, 21549, 53, 8, 59, 903, 3543 , 9, 15202, 0]]}

рдЗрд╕рдХреЗ рдмрд╛рдж, рдбреЗрдЯрд╛рд╕реЗрдЯ рдореЗрдВ рд╕рднреА рдирдореВрдиреЛрдВ рдХреЛ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди рддреИрдпрд╛рд░_рдЯреНрд░реЗрди_рдлреАрдЪрд░реНрд╕ рдХреЛ рдирдореВрдиреЗ рдкрд░ рд╕рднреА (рдореИрдк) рдкрд░ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдк рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

```рдЕрдЬрдЧрд░
рдЯреЛрдХрдирдпреБрдХреНрдд_рдбреЗрдЯрд╛рд╕реЗрдЯ = raw_datasets.map(рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕_рдлрд╝рдВрдХреНрд╢рди, рдмреИрдЪ = рд╕рд╣реА)
```

100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ|611/611 [02:32<00:00, 3.99ba/s]
100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ|2/2 [00:00<00:00, 3.76ba/s]
100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ| 2/2 [00:00<00:00, 3.89ba/s]

рдЗрд╕рд╕реЗ рднреА рдмреЗрд╣рддрд░, рдЕрдЧрд▓реА рдмрд╛рд░ рдкреБрдирд░реНрдЧрдгрдирд╛ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд▓реМрдЯрд╛рдП рдЧрдП рдкрд░рд┐рдгрд╛рдо рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреИрд╢ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВрд╕рдВрд╕рд╛рдзрд┐рдд (рд▓реЗрдХрд┐рди рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ рдпрджрд┐ рдЗрдирдкреБрдЯ рдмрджрд▓ рдЧрдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рдХреИрд╢ рд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ!) рдбреЗрдЯрд╛рд╕реЗрдЯ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдлрд╝рдВрдХреНрд╢рди рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рд╣реИ, рддреЛ рдХреИрд╢реНрдб рдбреЗрдЯрд╛ рд╣реЛрдЧрд╛ рдпрджрд┐ рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдкреБрди: рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЗрдирдкреБрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЬрдм рдЖрдк рдЗрдирдкреБрдЯ рдмрджрд▓рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдХреИрд╢ рдХреЛ рд╕рд╛рдлрд╝ рдХрд░рдирд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣реИред рд╕рд╛рдлрд╝ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ `load_from_cache_file=False `рдкреИрд░рд╛рдореАрдЯрд░ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, `рдмреАрдКрдкрд░ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдорд┐рд▓рд╛рди=рд╕рд╣реА рдкреИрд░рд╛рдореАрдЯрд░ рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рдХреА рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдЗрдирдкреБрдЯ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдереНрд░реЗрдбреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред

## рдЯреНрд░рд╛рдВрд╕рдлрд╛рд░реНрдорд░ рдореЙрдбрд▓ рдХреЛ рдорд╛рдЗрдХреНрд░реЛрдПрдбрдЬрд╕реНрдЯ рдХрд░реЗрдВ

рдЕрдм рдЬрдм рдбреЗрдЯрд╛ рддреИрдпрд╛рд░ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдЕрдкрдиреЗ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рд▓реЛрдб рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рдлрд┐рд░ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдХреЛ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо seq2seq рдХрд╛рд░реНрдп рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рд╣рдореЗрдВ рдПрдХ рдореЙрдбрд▓ рд╡рд░реНрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдЗрд╕ рдХрд╛рд░реНрдп рдХреЛ рд╣рд▓ рдХрд░ рд╕рдХреЗ рд╡рд░реНрдЧ `AutoModelForSeq2SeqLM` рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░ рдХреЗ рд╕рдорд╛рди, `from_pretrained` рд╡рд┐рдзрд┐ рднреА рд╣рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реИd рдореЙрдбрд▓ рдХреЛ рд▓реЛрдб рдХрд░реЗрдВ, рдФрд░ рдпрд╣ рдореЙрдбрд▓ рдХреЛ рдХреИрд╢ рднреА рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рд╣рдо рдореЙрдбрд▓ рдХреЛ рдмрд╛рд░-рдмрд╛рд░ рдбрд╛рдЙрдирд▓реЛрдб рди рдХрд░реЗрдВред

```рдЕрдЬрдЧрд░
рдЯреНрд░рд╛рдВрд╕рдлрд╛рд░реНрдорд░ рд╕реЗ AutoModelForSeq2SeqLM, DataCollatorForSeq2Seq, Seq2SeqTrainingArguments, Seq2SeqTrainer рдЖрдпрд╛рдд рдХрд░реЗрдВ

рдореЙрдбрд▓ = AutoModelForSeq2SeqLM.from_pretrained(model_checkpoint)
```

рдбрд╛рдЙрдирд▓реЛрдбрд┐рдВрдЧ: 100%|тЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИтЦИ|301рдПрдо/301рдПрдо [00:19<00:00, 15.1рдПрдордмреА/рд╕реЗрдХреЗрдВрдб]

рдЪреВрдБрдХрд┐ рд╣рдорд╛рд░рд╛ рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рдХрд╛рд░реНрдп рдорд╢реАрдиреА рдЕрдиреБрд╡рд╛рдж рд╣реИ, рдФрд░ рд╣рдо рдПрдХ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд seq2seq рдореЙрдбрд▓ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рд╣рдо рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рдпрд╣ рд╣рдореЗрдВ рд╕рдВрдХреЗрдд рджреЗрдЧрд╛ рдХрд┐ рдХреБрдЫ рдмреЗрдЬреЛрдбрд╝ рдиреНрдпреВрдореЙрдбрд▓ рдХреЛ рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рдЖрд░рдПрдПрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рднрд╛рд╖рд╛ рдореЙрдбрд▓ рдХреЗ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдореБрдЦ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдорд╢реАрди рдЕрдиреБрд╡рд╛рдж рдХреЗ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдореБрдЦ рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЖрд░рдВрдн рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛)ред

`Seq2SeqTrainer` рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдЙрдкрдХрд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ 3 рддрддреНрд╡реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╕реЗрдЯрд┐рдВрдЧреНрд╕/рдкреИрд░рд╛рдореАрдЯрд░ [`Seq2SeqTrainingArguments`](https://huggingface.co/transformers/main_classes/trainer.html#transformers .Seq2SeqTrainingArguments)редрдЗрд╕ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╕реЗрдЯрд┐рдВрдЧ рдореЗрдВ рд╡реЗ рд╕рднреА рдЧреБрдг рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

```рдЕрдЬрдЧрд░
рдмреИрдЪ_рдЖрдХрд╛рд░ = 16
рддрд░реНрдХ = Seq2SeqTrainingArguments(
"рдкрд░реАрдХреНрд╖рдг-рдЕрдиреБрд╡рд╛рдж",
рдореВрд▓реНрдпрд╛рдВрдХрди_рд░рдгрдиреАрддрд┐ = "рдпреБрдЧ",
рд╕реАрдЦрдиреЗ рдХреА рджрд░=2e-5,
рдкреНрд░рддрд┐_рдбрд┐рд╡рд╛рдЗрд╕_рдЯреНрд░реЗрди_рдмреИрдЪ_рдЖрдХрд╛рд░=рдмреИрдЪ_рдЖрдХрд╛рд░,
рдкреНрд░рддрд┐_рдбрд┐рд╡рд╛рдЗрд╕_eval_batch_size=рдмреИрдЪ_рдЖрдХрд╛рд░,
рд╡рдЬрд╝рди_рдХреНрд╖рдп=0.01,
save_total_limit=3,
num_train_epochs=1,
рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА_рд╕рд╛рде_рдЙрддреНрдкрдиреНрди=рд╕рддреНрдп,
fp16=рдЧрд▓рдд,
)
```

рдЙрдкрд░реЛрдХреНрдд рдореВрд▓реНрдпрд╛рдВрдХрди_рд░рдгрдиреАрддрд┐ = "рдпреБрдЧ" рдкреИрд░рд╛рдореАрдЯрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЛрдб рдХреЛ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдПрдХ рд╡реИрдз рдХрд╛рд░реНрдп рдХрд░реЗрдВрдЧреЗрдкреНрд░рддрд┐ рдпреБрдЧ рдПрдХ рдмрд╛рд░ рдореВрд▓реНрдпрд╛рдВрдХрдиред

рдЗрд╕ рдиреЛрдЯрдмреБрдХ рд╕реЗ рдкрд╣рд▓реЗ рдмреИрдЪ_рдЖрдХрд╛рд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдЪреВрдБрдХрд┐ рд╣рдорд╛рд░рд╛ рдбреЗрдЯрд╛рд╕реЗрдЯ рдмрдбрд╝рд╛ рд╣реИ рдФрд░ `Seq2SeqTrainer` рдореЙрдбрд▓реЛрдВ рдХреЛ рд╕рд╣реЗрдЬрддрд╛ рд░рд╣реЗрдЧрд╛, рд╣рдореЗрдВ рдЗрд╕реЗ рдЕрдзрд┐рдХрддрдо `save_total_limit=3` рдореЙрдбрд▓реЛрдВ рдХреЛ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рдирд╛ рд╣реЛрдЧрд╛ред

рдЕрдВрдд рдореЗрдВ, рд╣рдореЗрдВ рдЕрдкрдиреЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдЗрдирдкреБрдЯ рдХреЛ рдореЙрдбрд▓ рдореЗрдВ рдлреАрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдХреЛрд▓реЗрдЯрд░ рдбреЗрдЯрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

```рдЕрдЬрдЧрд░
data_colllator = DataCollatorForSeq2Seq(рдЯреЛрдХрдирд╛рдЗрдЬрд╝рд░, рдореЙрдбрд▓=рдореЙрдбрд▓)
```

`Seq2SeqTrainer` рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рдж рдЬреЛ рдЖрдЦрд┐рд░реА рдЪреАрдЬ рдмрдЪреА рд╣реИ рд╡рд╣ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдореВрд▓реНрдпрд╛рдВрдХрди рдкрджреНрдзрддрд┐ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рд╣рдо `рдореЗрдЯреНрд░рд┐рдХ` рдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВo рдореВрд▓реНрдпрд╛рдВрдХрди рдкреВрд░рд╛ рдХрд░реЗрдВред рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдореЙрдбрд▓ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рднреЗрдЬреЗрдВ, рд╣рдо рдбреЗрдЯрд╛ рдХреА рдХреБрдЫ рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рднреА рдХрд░реЗрдВрдЧреЗ:

```рдЕрдЬрдЧрд░
рдПрдирдкреА рдХреЗ рд░реВрдк рдореЗрдВ рд╕реБрдиреНрди рдЖрдпрд╛рдд рдХрд░реЗрдВ

рдбреАрдИрдПрдлрд╝ рдкреЛрд╕реНрдЯрдкреНрд░реЛрд╕реЗрд╕_рдЯреЗрдХреНрд╕реНрдЯ(рдкреНрд░реАрдбреНрд╕, рд▓реЗрдмрд▓реНрд╕):
рдкреНрд░реАрдбреНрд╕ = [рдкреНрд░реАрдбреНрд╕ рдореЗрдВ рдкреНрд░реАрдб рдХреЗ рд▓рд┐рдП рдкреНрд░реАрдб.рд╕реНрдЯреНрд░рд┐рдк()]
рд▓реЗрдмрд▓ = [[рд▓реЗрдмрд▓.рд╕реНрдЯреНрд░рд┐рдк()] рд▓реЗрдмрд▓ рдореЗрдВ рд▓реЗрдмрд▓ рдХреЗ рд▓рд┐рдП]

рд░рд┐рдЯрд░реНрди рдкреНрд░реАрдбреНрд╕, рд▓реЗрдмрд▓

рдбреАрдИрдПрдлрд╝ рдХрдВрдкреНрдпреВрдЯ_рдореЗрдЯреНрд░рд┐рдХреНрд╕(eval_preds):
рдкреНрд░реАрдбреНрд╕, рд▓реЗрдмрд▓реНрд╕ = eval_preds
рдпрджрд┐ isinstance(preds, tuple):
рдкреНрд░реАрдбреНрд╕ = рдкреНрд░реАрдбреНрд╕[0]
рдбрд┐рдХреЛрдбреЗрдб_рдкреНрд░реЗрдбреНрд╕ = рдЯреЛрдХрдирдирд╛рдЗрдЬрд░.рдмреИрдЪ_рдбреАрдХреЛрдб(рдкреНрд░реАрдбреНрд╕, рд╕реНрдХрд┐рдк_рд╕реНрдкреЗрд╢рд▓_рдЯреЛрдХреЗрдВрд╕=рдЯреНрд░реВ)

# -100 рдЗрдВрдЪ рдмрджрд▓реЗрдВрд▓реЗрдмрд▓ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЙрдиреНрд╣реЗрдВ рдбрд┐рдХреЛрдб рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред
рд▓реЗрдмрд▓ = np.where(рд▓реЗрдмрд▓ !=-100, рд▓реЗрдмрд▓, рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░.рдкреИрдб_рдЯреЛрдХрди_рдЖрдИрдбреА)
рдбрд┐рдХреЛрдбреЗрдб_рд▓реЗрдмрд▓реНрд╕ = рдЯреЛрдХрдирдирд╛рдЗрдЬрд░.рдмреИрдЪ_рдбреАрдХреЛрдб(рд▓реЗрдмрд▓реНрд╕, рд╕реНрдХрд┐рдк_рд╕реНрдкреЗрд╢рд▓_рдЯреЛрдХреЗрдВрд╕=рдЯреНрд░реВ)

# рдХреБрдЫ рд╕рд░рд▓ рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ
рдбрд┐рдХреЛрдбреЗрдб_рдкреНрд░реЗрдбреНрд╕, рдбрд┐рдХреЛрдбреЗрдб_рд▓реЗрдмрд▓реНрд╕ = рдкреЛрд╕реНрдЯрдкреНрд░реЛрд╕реЗрд╕_рдЯреЗрдХреНрд╕реНрдЯ(рдбрд┐рдХреЛрдбреЗрдб_рдкреНрд░реЗрдбреНрд╕, рдбрд┐рдХреЛрдбреЗрдб_рд▓реЗрдмрд▓реНрд╕)

рдкрд░рд┐рдгрд╛рдо = metric.compute(рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпрд╛рдВ=рдбреАрдХреЛрдбреЗрдб_рдкреНрд░реАрдбреНрд╕, рд╕рдВрджрд░реНрдн=рдбреАрдХреЛрдбреЗрдб_рд▓реЗрдмрд▓реНрд╕)
рдкрд░рд┐рдгрд╛рдо = {"рдмреНрд▓реВ": рдкрд░рд┐рдгрд╛рдо["рд╕реНрдХреЛрд░"]}

Prediction_lens = [np.count_nonzero(pred != рдЯреЛрдХрдирдирд╛рдЗрдЬрд╝рд░.pad_token_id) for pred in preds]
рдкрд░рд┐рдгрд╛рдо["рдЬрдирд░рд▓_len"] = np.mean(prediction_lens)result = {k: рд░рд╛рдЙрдВрдб(v, 4) for k, v in result.items()}
рд╡рд╛рдкрд╕реА рдкрд░рд┐рдгрд╛рдо
```

рдЕрдВрдд рдореЗрдВ, рд╕рднреА рдкреИрд░рд╛рдореАрдЯрд░/рдбреЗрдЯрд╛/рдореЙрдбрд▓ рдХреЛ `Seq2SeqTrainer` рдкрд░ рдкрд╛рд╕ рдХрд░реЗрдВ

```рдЕрдЬрдЧрд░
рдЯреНрд░реЗрдирд░ = Seq2SeqTrainer(
рдирдореВрдирд╛,
рддрд░реНрдХ,
рдЯреНрд░реЗрди_рдбреЗрдЯрд╛рд╕реЗрдЯ=рдЯреЛрдХрдирдпреБрдХреНрдд_рдбреЗрдЯрд╛рд╕реЗрдЯ["рдЯреНрд░реЗрди"],
eval_dataset=рдЯреЛрдХрдирдпреБрдХреНрдд_рдбреЗрдЯрд╛рд╕реЗрдЯ["рд╕рддреНрдпрд╛рдкрди"],
рдбреЗрдЯрд╛_рдХреЛрд▓реЗрдЯрд░=рдбреЗрдЯрд╛_рдХреЛрд▓реЗрдЯрд░,
рдЯреЛрдХрдирдирд╛рдЗрдЬрд░=рдЯреЛрдХрдирд╛рдЗрдЬрд░,
рдХрдВрдкреНрдпреВрдЯ_рдореЗрдЯреНрд░рд┐рдХреНрд╕ = рдХрдВрдкреНрдпреВрдЯ_рдореЗрдЯреНрд░рд┐рдХреНрд╕
)
```

рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП `рдЯреНрд░реЗрди` рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред

```рдЕрдЬрдЧрд░
рдЯреНрд░реЗрдирд░.рдЯреНрд░реЗрди()
```

рдЕрдВрдд рдореЗрдВ, рдЯреА рдХреЛ рдордд рднреВрд▓рдирд╛рдУ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдореЙрдбрд▓ рдХреИрд╕реЗ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдореЙрдбрд▓ рдХреЛ](https://huggingface.co/transformers/model_sharing.html) рдкрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВред [ЁЯдЧрдореЙрдбрд▓ рд╣рдм](https://huggingface.co/models) рдкрд░ рдЬрд╛рдПрдВ рдЗрд╕ рдиреЛрдЯрдмреБрдХ рдХреА рд╢реБрд░реБрдЖрдд рдХреА рддрд░рд╣, рдореЙрдбрд▓ рдирд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реАрдзреЗ рдЕрдкрдиреЗ рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

```рдЕрдЬрдЧрд░

```